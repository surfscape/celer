<UserControl
    x:Class="Celer.Views.UserControls.MainWindow.MenuBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:local="clr-namespace:Celer.Views.UserControls.MainWindow"
             xmlns:converters="clr-namespace:Celer.Converters"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">
    <UserControl.Resources>
        <Style TargetType="MenuItem">
            <Setter Property="VerticalAlignment" Value="Stretch"></Setter>
            <Setter Property="VerticalContentAlignment"
                    Value="Stretch"></Setter>
            <Setter Property="Foreground"
                    Value="{DynamicResource TextFillColorSecondaryBrush}" />
            <Setter Property="Padding" Value="12,5" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Grid>
                            <Border
                                x:Name="Border"
                                Padding="{TemplateBinding Padding}"
                                Background="{TemplateBinding Background}"
                                
                                CornerRadius="4"
                                Margin="0,0,0,0"
                                BorderThickness="0">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition x:Name="LeftColumn" Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <CheckBox
                                        x:Name="CheckMark"
                                        Grid.Column="0"
                                        Margin="0,0,4,0"
                                        VerticalAlignment="Center"
                                        IsChecked="{Binding IsChecked, RelativeSource={RelativeSource TemplatedParent}}"
                                        IsHitTestVisible="False"
                                        Visibility="Collapsed" />
                                    <ContentPresenter
                                        x:Name="Icon"
                                        Grid.Column="0"
                                        Margin="0,0,8,0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Content="{TemplateBinding Icon}">
                                        <ContentPresenter.Style>
                                            <Style TargetType="ContentPresenter">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsCheckable, RelativeSource={RelativeSource TemplatedParent}}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Icon, RelativeSource={RelativeSource TemplatedParent}}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentPresenter.Style>
                                    </ContentPresenter>
                                    <ContentPresenter
                                        Grid.Column="1"
                                        VerticalAlignment="Center"
                                        ContentSource="Header"
                                        RecognizesAccessKey="True" />
                                </Grid>
                            </Border>
                            <Popup
                                x:Name="PART_Popup"
                                AllowsTransparency="True"
                                Focusable="False"
                                IsOpen="{TemplateBinding IsSubmenuOpen}"
                                PopupAnimation="Fade">
                                <Border
                                    Padding="4"
                                    CornerRadius="4"
                                    BorderThickness="1"
                                    Background="{DynamicResource SolidBackgroundFillColorBaseBrush}"
                                    BorderBrush="{DynamicResource ControlElevationBorderBrush}">
                                    <StackPanel IsItemsHost="True" />
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}" />
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen"
                                     Value="True">
                                <Setter TargetName="Border"
                                        Property="Background"
                                        Value="{DynamicResource CardBackgroundFillColorSecondaryBrush}" />
                                <Setter Property="Foreground"
                                        Value="{DynamicResource TextFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsCheckable" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible" />
                            </Trigger>
                            <Trigger Property="Role" Value="TopLevelHeader">
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Bottom" />
                                <Setter TargetName="LeftColumn" Property="Width" Value="0" />
                            </Trigger>
                            <Trigger Property="Role" Value="SubmenuItem">
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Right" />
                                <Setter TargetName="LeftColumn" Property="Width" Value="24" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>
    <Menu
        BorderThickness="0"
        FontSize="12">
        <MenuItem 
            DataContext="{Binding DataContext, ElementName=NavigationMenu}"
                  d:DataContext="{d:DesignInstance Type=local:MenuBarNavigation}"
                  Command="{Binding GoBackCommand}"
            IsEnabled="{Binding CanGoBack}"
            Visibility="{Binding CanGoBack, Converter={StaticResource BoolToVisibilityConverter}}"
                  >
            <MenuItem.Header >
                <iconPacks:PackIconLucide Width="12"
                                          Height="12"
                                          Margin="0,2,0,0"
                                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                          Kind="ArrowLeft" />
            </MenuItem.Header>
        </MenuItem>
        <MenuItem Header="_App">
            <MenuItem Click="OpenSettings_Click"
                      Header="_Preferences"
                      InputGestureText="Ctrl+S">
                <MenuItem.Icon>
                    <iconPacks:PackIconLucide Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                              Kind="Settings" />
                </MenuItem.Icon>
            </MenuItem>
            <MenuItem Click="CloseApp_Click"
                      Header="_Exit" />
        </MenuItem>
        <MenuItem x:Name="NavigationMenu"
                  d:DataContext="{d:DesignInstance Type=local:MenuBarNavigation}"
                  Header="_View">
            <MenuItem Command="{Binding NavigateToTabCommand}"
                      CommandParameter="Dashboard"
                      Header="_Dashboard" />
            <MenuItem Command="{Binding NavigateToTabCommand}"
                      CommandParameter="Limpeza"
                      Header="_Cleaning" />
            <MenuItem Command="{Binding NavigateToTabCommand}"
                      CommandParameter="Optimization"
                      Header="_Optimization" />
            <MenuItem Command="{Binding NavigateToTabCommand}"
                      CommandParameter="Maintenance"
                      Header="_Maintenance" />
            <MenuItem Command="{Binding NavigateToTabCommand}"
                      CommandParameter="Privacidade"
                      Header="_Privacy &amp; Security" />
        </MenuItem>
        <MenuItem Header="_Tools">
            <MenuItem Click="OpenAmbientChecker_Click" Header="_Ambient Checker">
                <MenuItem.Icon>
                    <iconPacks:PackIconLucide Foreground="{DynamicResource TextFillColorSecondaryBrush}" Kind="MonitorCheck" />
                </MenuItem.Icon>
            </MenuItem>
            <MenuItem Click="CheckUpdates_Click" Header="_Check Updates">
                <MenuItem.Icon>
                    <iconPacks:PackIconLucide Foreground="{DynamicResource TextFillColorSecondaryBrush}" Kind="RefreshCw" />
                </MenuItem.Icon>
            </MenuItem>
        </MenuItem>
        <MenuItem x:Name="AboutMenu" Header="_Help">
            <MenuItem
                Command="{Binding OpenLinkCommand}"
                CommandParameter="https://surfscape.eu/support"
                Header="_Support">
                <MenuItem.Icon>
                    <iconPacks:PackIconLucide Foreground="{DynamicResource TextFillColorSecondaryBrush}" Kind="LifeBuoy" />
                </MenuItem.Icon>
            </MenuItem>
            <Separator />
            <MenuItem
                Command="{Binding OpenLinkCommand}"
                CommandParameter="https://cryptpad.disroot.org/form/#/2/form/view/jryIYOly60yYlx1sMiUFvgfa5JML2QV4aLDfPNDeags/"
                Header="_Feedback Form">
                <MenuItem.Icon>
                    <iconPacks:PackIconLucide Foreground="{DynamicResource TextFillColorSecondaryBrush}" Kind="HandHelping" />
                </MenuItem.Icon>
            </MenuItem>
            <MenuItem
                Command="{Binding OpenLinkCommand}"
                CommandParameter="https://cryptpad.disroot.org/form/#/2/form/view/C1r1yBjeghM5pg1Nzc4s050GsWA18ZKGQ83FNlAQ0zo/"
                Header="_Report Errors" />
            <Separator />
            <MenuItem
                Command="{Binding OpenLinkCommand}"
                CommandParameter="https://status.surfscape.eu"
                Header="_Service Status" />
            <MenuItem Command="{Binding OpenAboutWindowCommand}" Header="_About">
                <MenuItem.Icon>
                    <iconPacks:PackIconLucide Foreground="{DynamicResource TextFillColorSecondaryBrush}" Kind="Info" />
                </MenuItem.Icon>
            </MenuItem>
        </MenuItem>
    </Menu>
</UserControl>
